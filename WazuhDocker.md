# Documentation for

#### Wazuh on Docker: Self-signed HTTPS from first boot + change default admin and API passwords

[YouTube video](https://youtu.be/ds3IGEUM9B4)

---

#### References

- [Official Wazuh Docker guide](https://documentation.wazuh.com/current/deployment-options/docker/wazuh-container.html)
- [Changing default passwords](https://documentation.wazuh.com/current/deployment-options/docker/changing-default-password.html)

---

## Safety first

- This guide uses self-signed certificates generated by Wazuhâ€™s official tool. Browsers will warn on first visit.
- Required ports (host to containers): 443 (dashboard), 1514/TCP (events), 1515/TCP (enrollment).
- For the indexer (OpenSearch), Linux needs `vm.max_map_count=262144`.

---

## Prerequisites on the Docker host

**Docker already installed**

```bash
sudo apt update
sudo apt install -y git curl
# Required by the Wazuh Indexer (OpenSearch)
sudo sysctl -w vm.max_map_count=262144
```

Optional: add a hosts entry on your workstation. For example, map `wazuh.local` to your Docker host IP for easy access.

---

## Get the official Wazuh Docker stack

```bash
git clone https://github.com/wazuh/wazuh-docker.git -b v4.12.0
cd wazuh-docker/single-node
```

---

## Generate self-signed certificates with the official generator

Wazuh ships a generator that creates all required certs for the indexer, manager and dashboard. Run it once:

```bash
docker compose -f generate-indexer-certs.yml run --rm generator
sudo chown -R 1000:1000 config/wazuh_indexer_ssl_certs/
```

Certificates will appear in `config/wazuh_indexer_ssl_certs/`.

Key files include:

- `wazuh.indexer.pem`, `wazuh.indexer-key.pem`, `root-ca.pem`, `admin.pem`, `admin-key.pem`
- `wazuh.manager.pem`, `wazuh.manager-key.pem`, `root-ca-manager.pem`
- `wazuh.dashboard.pem`, `wazuh.dashboard-key.pem`, `root-ca.pem`

No reverse proxy is needed. The stack mounts these certs and the dashboard starts on HTTPS by default.

You can also use your own certificates. See the Wazuh documentation for details.

---

## Start the stack

```bash
docker compose up -d
```

Wait about ~60 seconds until everything is healthy, then open the dashboard:

- `https://<DOCKER_HOST_IP>/`  
- or `https://wazuh.local/` if you added a hosts entry

Default credentials (we will change them next):

- Dashboard login: `admin` and `SecretPassword`
- API user: `wazuh-wui` and `MyS3cr37P450r.*-`

A browser warning is expected because the certificate is self-signed.

---

## Change the default passwords

Log out of the dashboard first to avoid session issues. Change one user at a time.

### Indexer users (`admin` and `kibanaserver`)

1) Stop the stack.

```bash
docker compose down
```

2) Set your new passwords in `docker-compose.yml` where they are referenced by `wazuh.dashboard` and `wazuh.manager`. If your password contains `$`, escape it as `$$` in YAML.

3) Generate a password hash using the indexer image.

```bash
docker run --rm -ti wazuh/wazuh-indexer:4.12.0 \
  bash /usr/share/wazuh-indexer/plugins/opensearch-security/tools/hash.sh
```

Copy the resulting hash.

4) Edit `config/wazuh_indexer/internal_users.yml` and replace the `hash:` for the user you are changing. Example:

```yaml
admin:
  hash: "<PASTE_NEW_HASH_HERE>"
  reserved: true
  backend_roles:
  - "admin"
  description: "Admin user"
```

Save the file.

5) Apply the change and update the indexer security configuration.

```bash
docker compose up -d
```

Wait until the containers are running, then run the security admin tool in the indexer container:

```bash
docker exec -it single-node-wazuh.indexer-1 bash -lc '
  export INSTALLATION_DIR=/usr/share/wazuh-indexer;
  export CACERT=$INSTALLATION_DIR/certs/root-ca.pem;
  export KEY=$INSTALLATION_DIR/certs/admin-key.pem;
  export CERT=$INSTALLATION_DIR/certs/admin.pem;
  export JAVA_HOME=/usr/share/wazuh-indexer/jdk;
  bash /usr/share/wazuh-indexer/plugins/opensearch-security/tools/securityadmin.sh \
    -cd /usr/share/wazuh-indexer/opensearch-security/ -nhnv \
    -cacert $CACERT -cert $CERT -key $KEY -p 9200 -icl'
```

Log in to the dashboard with the new credentials.

Repeat for `kibanaserver` if needed. Update its hash and every reference in `docker-compose.yml`. Do one user per run.

### Wazuh API user (`wazuh-wui`)

1) Edit `config/wazuh_dashboard/wazuh.yml`.

```yaml
hosts:
  - 1513629884013:
      url: "https://wazuh.manager"
      port: 55000
      username: wazuh-wui
      password: "<NEW_API_PASSWORD>"
      run_as: false
```

2) Update every occurrence of the API password in the `docker-compose.yml` environment sections for `wazuh.manager` and `wazuh.dashboard`.

```yaml
- API_USERNAME=wazuh-wui
- API_PASSWORD=<NEW_API_PASSWORD>
```

3) Recreate the containers.

```bash
docker compose down
docker compose up -d
```

---

## Enroll a Linux agent

In the dashboard, open the menu, then **Agents Management**, **Summary**, then **Deploy new agent**. Choose Linux, copy the commands and run them on the client.

Open firewall if needed:

- 1514/TCP from the agent to the manager for events
- 1515/TCP from the agent to the manager for enrollment

Verify the agent shows **Active** in the dashboard.

---

## Quick test: generate a few events

On the enrolled Linux host:

```bash
sudo ls
sudo systemctl restart ssh
```

In the dashboard, open **Security events**, filter by your agent and confirm logs arrive.

---

## Next steps
- Notifications (email and Slack)
- Add Windows and macOS agents
- Rule and decoder tuning, index lifecycle
